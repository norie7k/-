# 预计算方案使用说明

## 概述

由于 Streamlit Cloud 免费版有约 10 分钟的超时限制，一整天的数据分析（15-30分钟）无法在云端完成。

**本方案的思路：**
1. 在本地 Jupyter Notebook 运行分析
2. 保存结果为 JSON 文件
3. 推送到 GitHub
4. 使用独立的网页查看历史结果

---

## 步骤一：在 Jupyter Notebook 中保存结果

在 `top5_Q2.ipynb` 的**最后一个 Cell** 添加以下代码：

```python
# 导入保存函数
import sys
sys.path.insert(0, r"E:\项目\玩家社群分析智能体")
from 预计算方案.notebook_helper import save_analysis_result

# 保存结果（在分析完成后调用）
save_analysis_result(
    merged_top5=merged_top5,           # 分析结果
    date=start_time.split(" ")[0],     # 日期
    time_range=f"{start_time} ~ {end_time}",  # 时间范围
    total_messages=len(jsonl_lines01), # 原始消息数
    filtered_messages=written_total,   # 筛选后消息数
)
```

运行后会输出：
```
✅ 结果已保存到: E:\项目\玩家社群分析智能体\预计算方案\results\2025-12-23.json

下一步：
1. git add 预计算方案/results/2025-12-23.json
2. git commit -m "添加 2025-12-23 分析结果"
3. git push
```

---

## 步骤二：推送到 GitHub

每次保存结果后，执行：

```bash
cd E:\项目\玩家社群分析智能体
git add 预计算方案/results/
git commit -m "添加分析结果"
git push
```

---

## 步骤三：查看结果

### 方式 A：本地查看（推荐）

```bash
cd E:\项目\玩家社群分析智能体\预计算方案
streamlit run app.py
```

然后访问 http://localhost:8501

### 方式 B：部署到 Streamlit Cloud

1. 在 Streamlit Cloud 创建新应用
2. 选择仓库：`norie7k/-`
3. 主文件路径：`预计算方案/app.py`
4. 部署后获得独立的网页链接

---

## 文件说明

```
预计算方案/
├── app.py              # 独立的 Streamlit 网页（查看历史结果）
├── notebook_helper.py  # Jupyter Notebook 辅助函数
├── save_result.py      # 命令行保存脚本
├── requirements.txt    # 依赖
├── results/            # 保存的 JSON 结果文件
│   ├── 2025-12-23.json
│   └── ...
└── 使用说明.md         # 本文件
```

---

## 备用方案：命令行脚本

```bash
cd E:\项目\玩家社群分析智能体\预计算方案

python save_result.py ^
    --txt "聊天记录.txt" ^
    --mapping "mapping.xlsx" ^
    --start "2025-12-23 00:00:00" ^
    --end "2025-12-24 00:00:00"
```
